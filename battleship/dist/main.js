(()=>{"use strict";class t{constructor(t){this.activePositions=t,this.length=t.length}getActivePositions(){return this.activePositions}isSunk(){return 0===this.activePositions.length}hit(t,e){let r=this.activePositions.findIndex((r=>r[0]===t&&r[1]===e));return r>=0&&(this.activePositions.splice(r,1),!0)}}class e{constructor(t){this.ships=[],this.size=t,this.board=[];for(let e=0;e<t;e++){this.board.push([]);for(let r=0;r<t;r++)this.board[e].push(0)}}getShips(){return this.ships}getSize(){return this.size}getBoard(){return this.board}addShip(e,r,o){let i=function(e,r,o){if(e<0)throw new Error("Invalid length");if(!Array.isArray(r))throw new Error("Invalid head position. Head position must be an array.");if(2!=r.length)throw new Error("Invalid head position. Head position must have 2 coordinates [x,y].");if("north"!==o&&"west"!==o)throw console.log(o),new Error("Invalid direction faced");let i=[],s=r[0],a=r[1];for(let t=0;t<e;t++)i.push([s,a]),"north"===o&&a++,"west"===o&&s++;return new t(i)}(e,r,o);switch(o){case"north":if(r[1]+e>this.size)throw new Error("Ship is out of bounds");break;case"west":if(r[0]+e>this.size)throw new Error("Ship is out of bounds")}let s=!1;return i.getActivePositions().forEach((t=>{let e=t[0],r=t[1];if(0!==this.board[r][e])return s=!0,-1})),s?-1:(i.getActivePositions().forEach((t=>{let e=t[0],r=t[1];this.board[r][e]=1})),this.ships.push(i),this.ships)}receiveAttack(t,e){if(t<0||e<0||t>=this.size||e>=this.size)throw new Error("Invalid coordinates");return!!this.ships.some((r=>{if(r.hit(t,e))return this.board[e][t]=3,!0}))||(this.board[e][t]=2,!1)}allShipsSunk(){return this.ships.every((t=>t.isSunk()))}randomizeBoard(t){let e=Math.random()>.5?"north":"west",r=!1;for(;!r;){let o=Math.floor(Math.random()*(t-2)),i=Math.floor(Math.random()*(t-2));-1!==this.addShip(3,[i,o],e)&&(r=!0)}for(let o=0;o<2;o++)for(e=Math.random()>.5?"north":"west",r=!1;!r;){let o=Math.floor(Math.random()*(t-1)),i=Math.floor(Math.random()*(t-1));-1!==this.addShip(2,[i,o],e)&&(r=!0)}for(let o=0;o<2;o++)for(e=Math.random()>.5?"north":"west",r=!1;!r;){let o=Math.floor(Math.random()*t),i=Math.floor(Math.random()*t);-1!==this.addShip(1,[i,o],e)&&(r=!0)}return!0}}function r(t){return new e(t)}const o=document.querySelector("#content");class i{constructor(t,e,r,o){this.playerBoard=t,this.playerBoardElement=e,this.computerBoard=r,this.computerBoardElement=o}getPlayerBoard(){return this.playerBoard}getPlayerBoardElement(){return this.playerBoardElement}getComputerBoard(){return this.computerBoard}getComputerBoardElement(){return this.computerBoardElement}}function s(t){r(t);const e=document.createElement("div");e.setAttribute("class","gameboard");const o=document.createElement("table");for(let e=0;e<t;e++){let e=document.createElement("tr");for(let r=0;r<t;r++){let t=document.createElement("td");e.appendChild(t),t.setAttribute("class","empty unhit"),t.addEventListener("click",(t=>{}))}o.appendChild(e)}return e.appendChild(o),e}function a(t,e){let r,o;switch(e){case"player":r=t.getPlayerBoard().getBoard(),o=t.getPlayerBoardElement().firstChild.children;break;case"computer":r=t.getComputerBoard().getBoard(),o=t.getComputerBoardElement().firstChild.children;break;default:throw new Error("Invalid player")}for(let t=0;t<6;t++){let i=o[t].children;for(let o=0;o<6;o++){let s=i[o];switch(r[t][o]){case 0:s.setAttribute("class","empty unhit");break;case 1:"player"===e&&s.setAttribute("class","ship unhit");break;case 2:s.setAttribute("class","empty hit");break;case 3:s.setAttribute("class","ship hit");break;default:throw new Error("Invalid game board.")}}}}!function(){o.replaceChildren();const t=r(6),e=s(6);e.setAttribute("class","gameboard playerBoard");const n=r(6),h=s(6);h.setAttribute("class","gameboard computerBoard"),o.appendChild(e),o.appendChild(h),n.randomizeBoard(6),function(t){let e=t.getComputerBoard(),r=t.getComputerBoardElement().firstChild.children;for(let o=0;o<6;o++){let i=r[o].children;for(let r=0;r<6;r++){let s=i[r];s.addEventListener("click",(i=>{"empty unhit"!==s.getAttribute("class")&&"ship unhit"!==s.getAttribute("class")||(e.receiveAttack(r,o),a(t,"computer"))}))}}}(new i(t,e,n,h))}()})();